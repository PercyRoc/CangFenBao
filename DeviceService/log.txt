2025-07-31 15:01:04.491 +08:00 [DBG] 开始处理识别结果
2025-07-31 15:01:04.491 +08:00 [DBG] 设置触发时间戳: "2025-07-31T15:01:03.8010000+08:00"
2025-07-31 15:01:04.491 +08:00 [DBG] 设置包裹重量: 1.22 kg
2025-07-31 15:01:04.491 +08:00 [DBG] 设置包裹尺寸: L=26.90650329589844cm W=17.957424926757813cm H=14.6cm, Vol=7054.3cm³
2025-07-31 15:01:04.491 +08:00 [DBG] 已设置包裹图像
2025-07-31 15:01:04.491 +08:00 [INF] 已通过过滤器, 开始处理图像和保存.
2025-07-31 15:01:04.491 +08:00 [DBG] 生成潜在图像路径: D:\科\2025\07\31\78524833280058_20250731150104491.jpg
2025-07-31 15:01:04.491 +08:00 [DBG] 已更新 PackageInfo 的 ImagePath (可能为 null).
2025-07-31 15:01:04.492 +08:00 [DBG] 准备启动后台任务保存带水印图像.
2025-07-31 15:01:04.492 +08:00 [DBG] 图像处理和保存流程完成 (保存任务可能仍在后台运行).
2025-07-31 15:01:04.493 +08:00 [INF] 开始上传称重数据到安通API: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:04.493 +08:00 [DBG] 请求报文: {"WaybillCode":"78524833280058","Weight":1.22}
2025-07-31 15:01:04.493 +08:00 [DBG] GET请求URL: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:04.493 +08:00 [DBG] 请求体: {"waybillCode":"78524833280058","weight":"1.22"}
2025-07-31 15:01:04.493 +08:00 [INF] 包裹处理完成 - 各阶段耗时统计: 总耗时=3.3ms, 信号量等待=0.0ms, 图像处理=1.0ms, 对象创建=0.0ms, 条码设置=0.0ms, 时间戳设置=0.1ms, 重量设置=0.0ms, 尺寸设置=0.0ms, 图像设置=0.0ms, 数据处理=0.3ms, 推送耗时=2.0ms
2025-07-31 15:01:04.493 +08:00 [DBG] 后台保存任务开始.
2025-07-31 15:01:04.548 +08:00 [INF] 图像成功保存至 D:\科\2025\07\31\78524833280058_20250731150104491.jpg
2025-07-31 15:01:04.760 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:04.821 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:04.919 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:04.920 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:04.992 +08:00 [INF] 后台带水印图像保存成功, 路径: D:\科\2025\07\31\8167648889908_20250731150101184.jpg
2025-07-31 15:01:04.992 +08:00 [DBG] 后台保存任务结束.
2025-07-31 15:01:04.992 +08:00 [INF] 安通API称重数据上传成功: {"code":"0","msg":"Success","errMsg":null,"timestamp":"2025-07-31 15:01:06:413","data":{"provinceName":"山西省","carrierCode":"ZTO"}}
2025-07-31 15:01:04.992 +08:00 [INF] 包裹 78524833280058 安通API称重数据上传成功
2025-07-31 15:01:04.992 +08:00 [INF] 包裹 78524833280058 本地规则匹配到格口 1
2025-07-31 15:01:04.992 +08:00 [DBG] 已通过 EventAggregator 发布 PackageProcessingEvent.
2025-07-31 15:01:04.992 +08:00 [INF] 收到包裹 2839|78524833280058, 准备处理.
2025-07-31 15:01:04.992 +08:00 [DBG] 开始处理流程.
2025-07-31 15:01:04.993 +08:00 [DBG] 已有触发时间戳 15:01:03.801，跳过匹配逻辑.
2025-07-31 15:01:04.993 +08:00 [INF] 已添加到待处理队列. 目标格口: 1
2025-07-31 15:01:04.993 +08:00 [DBG] 设置分拣超时时间: 3500ms (光电 '光电1' 上限 3000ms + 500ms)
2025-07-31 15:01:04.993 +08:00 [DBG] 添加包裹记录：Barcode=78524833280058, CreateTime=2025-07-31 15:01:04, Status="Success"
2025-07-31 15:01:05.011 +08:00 [DBG] 添加包裹记录成功：78524833280058，已存入表 Packages_202507
2025-07-31 15:01:05.011 +08:00 [INF] 包裹记录已保存到数据库：78524833280058
2025-07-31 15:01:05.011 +08:00 [DBG] 回正延迟正常结束，开始执行回正
2025-07-31 15:01:05.011 +08:00 [DBG] 执行延迟回正.
2025-07-31 15:01:05.011 +08:00 [DBG] 根据保存的摆轮方向 "SwingingLeft" 确定回正方向为: 左
2025-07-31 15:01:05.012 +08:00 [DBG] 准备发送延迟 左 回正命令 (AT+STACH2=0)...
2025-07-31 15:01:05.012 +08:00 [DBG] 准备向 光电1 发送命令: AT+STACH2=0
2025-07-31 15:01:05.012 +08:00 [DBG] 设备 光电1 发送数据: 41-54-2B-53-54-41-43-48-32-3D-30-0D-0A
2025-07-31 15:01:05.012 +08:00 [DBG] 设备 光电1 数据发送完成
2025-07-31 15:01:05.012 +08:00 [DBG] 命令 AT+STACH2=0 已成功发送到 光电1
2025-07-31 15:01:05.012 +08:00 [INF] 延迟 左 回正命令 (AT+STACH2=0) 发送成功.
2025-07-31 15:01:05.012 +08:00 [DBG] 摆轮状态更新为: Reset
2025-07-31 15:01:05.012 +08:00 [DBG] 分拣动作完成，已从待处理队列移除. 已处理回正
2025-07-31 15:01:05.012 +08:00 [DBG] 包裹分拣状态已更新为: Sorted
2025-07-31 15:01:05.012 +08:00 [DBG] 已从处理中状态移除.
2025-07-31 15:01:05.012 +08:00 [DBG] 分拣光电 光电2 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:05.012 +08:00 [INF] 分拣光电 光电2 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:05.012 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:05.012 +08:00 [DBG] 分拣光电 光电2 触发，开始匹配包裹...
2025-07-31 15:01:05.012 +08:00 [INF] 开始遍历 3 个待处理包裹进行匹配...
2025-07-31 15:01:05.012 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 8167648889908, 目标格口: 3, 触发时间: 15:01:00.570, 分拣状态: "Pending"
2025-07-31 15:01:05.012 +08:00 [INF] ⏱️ 时间差计算: 当前时间 15:01:05.012 - 触发时间 15:01:00.570 = 4442.6ms
2025-07-31 15:01:05.012 +08:00 [INF] 📏 时间范围检查: 延迟 4442.6ms, 允许范围 [3800.0 - 4500.0]ms, 结果: ✅ 符合
2025-07-31 15:01:05.012 +08:00 [INF] 🎯 匹配成功! 包裹条码: 8167648889908, 格口: 3, 延迟: 4442.6ms, 光电: 光电2
2025-07-31 15:01:05.012 +08:00 [DBG] 包裹 8167648889908 已标记为由光电 光电2 处理中.
2025-07-31 15:01:05.012 +08:00 [DBG] 包裹条码: 8167648889908, 匹配成功，已停止并移除超时定时器.
2025-07-31 15:01:05.012 +08:00 [INF] 分拣光电 光电2 匹配到包裹 2836|8167648889908 (耗时: 4442.96ms)
2025-07-31 15:01:05.013 +08:00 [INF] 开始执行分拣动作 (光电: 光电2, 格口: 3).
2025-07-31 15:01:05.013 +08:00 [DBG] 分拣光电 光电1 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:05.013 +08:00 [DBG] 分拣光电 光电2 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:05.013 +08:00 [DBG] 分拣光电 光电1 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:05.013 +08:00 [INF] 分拣光电 光电1 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:05.013 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:05.013 +08:00 [DBG] 分拣光电 光电1 触发，开始匹配包裹...
2025-07-31 15:01:05.013 +08:00 [INF] 开始遍历 3 个待处理包裹进行匹配...
2025-07-31 15:01:05.013 +08:00 [DBG] 设备 光电1 接收到 4 字节数据: 4F-4B-0D-0A
2025-07-31 15:01:05.013 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 8167648889908, 目标格口: 3, 触发时间: 15:01:00.570, 分拣状态: "Processing"
2025-07-31 15:01:05.013 +08:00 [DBG] 包裹 2836|8167648889908 匹配失败: 分拣状态为 "Processing"，非待处理.
2025-07-31 15:01:05.013 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:05.013 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 8498507911911, 目标格口: 3, 触发时间: 15:01:02.882, 分拣状态: "Pending"
2025-07-31 15:01:05.013 +08:00 [DBG] 包裹 2838|8498507911911 匹配失败: 格口 3 不属于光电 光电1.
2025-07-31 15:01:05.013 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:05.013 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524833280058, 目标格口: 1, 触发时间: 15:01:03.801, 分拣状态: "Pending"
2025-07-31 15:01:05.013 +08:00 [INF] 包裹 2839|78524833280058 匹配失败: 时间范围不匹配. 时间差: 1212.2ms, 允许范围: [2000.0 - 3000.0]ms.
2025-07-31 15:01:05.013 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:05.013 +08:00 [DBG] 分拣光电 光电1: 未找到符合条件的待处理包裹.
2025-07-31 15:01:05.013 +08:00 [WRN] 触发光电连接断开，已禁用重连逻辑，跳过重连
2025-07-31 15:01:05.013 +08:00 [DBG] 分拣光电 光电1 收到未知信号 'OK
'，已忽略
2025-07-31 15:01:05.227 +08:00 [DBG] 摆动前状态检查 - 目标方向: "SwingingLeft", 当前状态: "Reset"
2025-07-31 15:01:05.227 +08:00 [INF] 状态不匹配：目标方向 "SwingingLeft" 与当前状态 "Reset" 不一致，执行纠正流程
2025-07-31 15:01:05.227 +08:00 [DBG] 发送摆动命令: 左摆 (AT+STACH2=1)
2025-07-31 15:01:05.227 +08:00 [DBG] 准备向 光电2 发送命令: AT+STACH2=1
2025-07-31 15:01:05.227 +08:00 [DBG] 设备 光电2 发送数据: 41-54-2B-53-54-41-43-48-32-3D-31-0D-0A
2025-07-31 15:01:05.228 +08:00 [DBG] 设备 光电2 数据发送完成
2025-07-31 15:01:05.228 +08:00 [DBG] 命令 AT+STACH2=1 已成功发送到 光电2
2025-07-31 15:01:05.228 +08:00 [DBG] 摆轮状态更新为: "SwingingLeft"
2025-07-31 15:01:05.228 +08:00 [INF] 已发送摆动命令: 左摆 (AT+STACH2=1) 并更新状态为: SwingingLeft
2025-07-31 15:01:05.228 +08:00 [DBG] 更新最后处理的格口为: 3
2025-07-31 15:01:05.228 +08:00 [DBG] 包裹 2836|8167648889908 匹配失败: 分拣状态为 "Processing"，非待处理.
2025-07-31 15:01:05.228 +08:00 [DBG] 找到连续分拣包裹，格口: 3，包裹: 2838
2025-07-31 15:01:05.228 +08:00 [DBG] 摆轮状态更新为: WaitingForNext，等待格口: 3，开始时间: "2025-07-31T15:01:05.2284682+08:00"
2025-07-31 15:01:05.228 +08:00 [INF] 连续分拣优化: 发现下一个包裹格口相同(3)，跳过回正，等待下一个包裹 (包裹: 2838)
2025-07-31 15:01:05.228 +08:00 [DBG] 分拣动作完成，已从待处理队列移除 (智能回正-跳过回正)
2025-07-31 15:01:05.228 +08:00 [DBG] 已从处理中状态移除.
2025-07-31 15:01:05.228 +08:00 [DBG] 设备 光电2 接收到 4 字节数据: 4F-4B-0D-0A
2025-07-31 15:01:05.246 +08:00 [DBG] 分拣光电 光电2 收到未知信号 'OK
'，已忽略
2025-07-31 15:01:05.531 +08:00 [DBG] 开始处理识别结果
2025-07-31 15:01:05.531 +08:00 [DBG] 设置触发时间戳: "2025-07-31T15:01:04.8660000+08:00"
2025-07-31 15:01:05.532 +08:00 [DBG] 设置包裹重量: 2.2 kg
2025-07-31 15:01:05.532 +08:00 [DBG] 设置包裹尺寸: L=25.369082641601562cm W=15.882524108886718cm H=13.1cm, Vol=5278.32cm³
2025-07-31 15:01:05.533 +08:00 [DBG] 已设置包裹图像
2025-07-31 15:01:05.533 +08:00 [INF] 已通过过滤器, 开始处理图像和保存.
2025-07-31 15:01:05.533 +08:00 [DBG] 生成潜在图像路径: D:\科\2025\07\31\78524890654948_20250731150105530.jpg
2025-07-31 15:01:05.533 +08:00 [DBG] 已更新 PackageInfo 的 ImagePath (可能为 null).
2025-07-31 15:01:05.533 +08:00 [DBG] 准备启动后台任务保存带水印图像.
2025-07-31 15:01:05.533 +08:00 [DBG] 图像处理和保存流程完成 (保存任务可能仍在后台运行).
2025-07-31 15:01:05.535 +08:00 [INF] 开始上传称重数据到安通API: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:05.535 +08:00 [DBG] 请求报文: {"WaybillCode":"78524890654948","Weight":2.2}
2025-07-31 15:01:05.535 +08:00 [DBG] GET请求URL: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:05.535 +08:00 [DBG] 请求体: {"waybillCode":"78524890654948","weight":"2.2"}
2025-07-31 15:01:05.535 +08:00 [INF] 包裹处理完成 - 各阶段耗时统计: 总耗时=9.1ms, 信号量等待=0.0ms, 图像处理=3.9ms, 对象创建=1.0ms, 条码设置=0.0ms, 时间戳设置=1.3ms, 重量设置=0.1ms, 尺寸设置=0.0ms, 图像设置=0.0ms, 数据处理=2.9ms, 推送耗时=2.3ms
2025-07-31 15:01:05.535 +08:00 [DBG] 后台保存任务开始.
2025-07-31 15:01:05.608 +08:00 [INF] 图像成功保存至 D:\科\2025\07\31\78524890654948_20250731150105530.jpg
2025-07-31 15:01:05.766 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:05.966 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:06.401 +08:00 [INF] 后台带水印图像保存成功, 路径: D:\科\2025\07\31\78927938765126_20250731150102293.jpg
2025-07-31 15:01:06.401 +08:00 [DBG] 后台保存任务结束.
2025-07-31 15:01:06.401 +08:00 [INF] 安通API称重数据上传成功: {"code":"0","msg":"Success","errMsg":null,"timestamp":"2025-07-31 15:01:07:411","data":{"provinceName":"河北省","carrierCode":"ZTO"}}
2025-07-31 15:01:06.402 +08:00 [INF] 包裹 78524890654948 安通API称重数据上传成功
2025-07-31 15:01:06.402 +08:00 [INF] 包裹 78524890654948 本地规则匹配到格口 1
2025-07-31 15:01:06.402 +08:00 [DBG] 已通过 EventAggregator 发布 PackageProcessingEvent.
2025-07-31 15:01:06.402 +08:00 [INF] 收到包裹 2840|78524890654948, 准备处理.
2025-07-31 15:01:06.402 +08:00 [DBG] 开始处理流程.
2025-07-31 15:01:06.402 +08:00 [DBG] 已有触发时间戳 15:01:04.866，跳过匹配逻辑.
2025-07-31 15:01:06.402 +08:00 [INF] 已添加到待处理队列. 目标格口: 1
2025-07-31 15:01:06.402 +08:00 [DBG] 设置分拣超时时间: 3500ms (光电 '光电1' 上限 3000ms + 500ms)
2025-07-31 15:01:06.402 +08:00 [DBG] 添加包裹记录：Barcode=78524890654948, CreateTime=2025-07-31 15:01:05, Status="Success"
2025-07-31 15:01:06.419 +08:00 [DBG] 添加包裹记录成功：78524890654948，已存入表 Packages_202507
2025-07-31 15:01:06.419 +08:00 [INF] 包裹记录已保存到数据库：78524890654948
2025-07-31 15:01:06.419 +08:00 [WRN] 触发光电连接断开，已禁用重连逻辑，跳过重连
2025-07-31 15:01:06.419 +08:00 [DBG] 分拣光电 光电1 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:06.419 +08:00 [DBG] 分拣光电 光电1 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:06.419 +08:00 [INF] 分拣光电 光电1 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:06.419 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:06.419 +08:00 [DBG] 分拣光电 光电1 触发，开始匹配包裹...
2025-07-31 15:01:06.419 +08:00 [INF] 开始遍历 3 个待处理包裹进行匹配...
2025-07-31 15:01:06.419 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 8498507911911, 目标格口: 3, 触发时间: 15:01:02.882, 分拣状态: "Pending"
2025-07-31 15:01:06.419 +08:00 [DBG] 包裹 2838|8498507911911 匹配失败: 格口 3 不属于光电 光电1.
2025-07-31 15:01:06.419 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:06.419 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524833280058, 目标格口: 1, 触发时间: 15:01:03.801, 分拣状态: "Pending"
2025-07-31 15:01:06.420 +08:00 [INF] ⏱️ 时间差计算: 当前时间 15:01:06.419 - 触发时间 15:01:03.801 = 2618.8ms
2025-07-31 15:01:06.420 +08:00 [INF] 📏 时间范围检查: 延迟 2618.8ms, 允许范围 [2000.0 - 3000.0]ms, 结果: ✅ 符合
2025-07-31 15:01:06.420 +08:00 [INF] 🎯 匹配成功! 包裹条码: 78524833280058, 格口: 1, 延迟: 2618.8ms, 光电: 光电1
2025-07-31 15:01:06.420 +08:00 [DBG] 包裹 78524833280058 已标记为由光电 光电1 处理中.
2025-07-31 15:01:06.420 +08:00 [DBG] 包裹条码: 78524833280058, 匹配成功，已停止并移除超时定时器.
2025-07-31 15:01:06.420 +08:00 [INF] 分拣光电 光电1 匹配到包裹 2839|78524833280058 (耗时: 2619.21ms)
2025-07-31 15:01:06.420 +08:00 [INF] 开始执行分拣动作 (光电: 光电1, 格口: 1).
2025-07-31 15:01:06.421 +08:00 [DBG] 开始处理识别结果
2025-07-31 15:01:06.421 +08:00 [DBG] 设置触发时间戳: "2025-07-31T15:01:05.9260000+08:00"
2025-07-31 15:01:06.421 +08:00 [DBG] 设置包裹重量: 1.5 kg
2025-07-31 15:01:06.421 +08:00 [DBG] 设置包裹尺寸: L=29.792413330078126cm W=19.06305389404297cm H=16.6cm, Vol=9427.71cm³
2025-07-31 15:01:06.421 +08:00 [DBG] 已设置包裹图像
2025-07-31 15:01:06.421 +08:00 [INF] 已通过过滤器, 开始处理图像和保存.
2025-07-31 15:01:06.421 +08:00 [DBG] 生成潜在图像路径: D:\科\2025\07\31\78927962042351_20250731150106421.jpg
2025-07-31 15:01:06.421 +08:00 [DBG] 已更新 PackageInfo 的 ImagePath (可能为 null).
2025-07-31 15:01:06.422 +08:00 [DBG] 准备启动后台任务保存带水印图像.
2025-07-31 15:01:06.422 +08:00 [DBG] 图像处理和保存流程完成 (保存任务可能仍在后台运行).
2025-07-31 15:01:06.422 +08:00 [INF] 开始上传称重数据到安通API: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:06.422 +08:00 [DBG] 请求报文: {"WaybillCode":"78927962042351","Weight":1.5}
2025-07-31 15:01:06.423 +08:00 [DBG] GET请求URL: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:06.423 +08:00 [DBG] 请求体: {"waybillCode":"78927962042351","weight":"1.5"}
2025-07-31 15:01:06.423 +08:00 [INF] 包裹处理完成 - 各阶段耗时统计: 总耗时=2.9ms, 信号量等待=0.0ms, 图像处理=1.2ms, 对象创建=0.0ms, 条码设置=0.0ms, 时间戳设置=0.0ms, 重量设置=0.0ms, 尺寸设置=0.0ms, 图像设置=0.0ms, 数据处理=0.2ms, 推送耗时=1.5ms
2025-07-31 15:01:06.423 +08:00 [DBG] 后台保存任务开始.
2025-07-31 15:01:06.477 +08:00 [INF] 图像成功保存至 D:\科\2025\07\31\78927962042351_20250731150106421.jpg
2025-07-31 15:01:06.832 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:07.041 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:07.115 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:07.235 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:07.448 +08:00 [INF] 后台带水印图像保存成功, 路径: D:\科\2025\07\31\8498507911911_20250731150103265.jpg
2025-07-31 15:01:07.448 +08:00 [DBG] 后台保存任务结束.
2025-07-31 15:01:07.449 +08:00 [INF] 安通API称重数据上传成功: {"code":"0","msg":"Success","errMsg":null,"timestamp":"2025-07-31 15:01:08:286","data":{"provinceName":"黑龙江省","carrierCode":"ZTO"}}
2025-07-31 15:01:07.449 +08:00 [INF] 包裹 78927962042351 安通API称重数据上传成功
2025-07-31 15:01:07.449 +08:00 [INF] 包裹 78927962042351 本地规则匹配到格口 1
2025-07-31 15:01:07.449 +08:00 [DBG] 已通过 EventAggregator 发布 PackageProcessingEvent.
2025-07-31 15:01:07.449 +08:00 [INF] 收到包裹 2841|78927962042351, 准备处理.
2025-07-31 15:01:07.449 +08:00 [DBG] 开始处理流程.
2025-07-31 15:01:07.449 +08:00 [DBG] 已有触发时间戳 15:01:05.926，跳过匹配逻辑.
2025-07-31 15:01:07.449 +08:00 [INF] 已添加到待处理队列. 目标格口: 1
2025-07-31 15:01:07.449 +08:00 [DBG] 设置分拣超时时间: 3500ms (光电 '光电1' 上限 3000ms + 500ms)
2025-07-31 15:01:07.450 +08:00 [DBG] 添加包裹记录：Barcode=78927962042351, CreateTime=2025-07-31 15:01:06, Status="Success"
2025-07-31 15:01:07.470 +08:00 [DBG] 添加包裹记录成功：78927962042351，已存入表 Packages_202507
2025-07-31 15:01:07.470 +08:00 [INF] 包裹记录已保存到数据库：78927962042351
2025-07-31 15:01:07.470 +08:00 [DBG] 摆动前状态检查 - 目标方向: "SwingingLeft", 当前状态: "Reset"
2025-07-31 15:01:07.470 +08:00 [INF] 状态不匹配：目标方向 "SwingingLeft" 与当前状态 "Reset" 不一致，执行纠正流程
2025-07-31 15:01:07.470 +08:00 [DBG] 发送摆动命令: 左摆 (AT+STACH2=1)
2025-07-31 15:01:07.470 +08:00 [DBG] 准备向 光电1 发送命令: AT+STACH2=1
2025-07-31 15:01:07.470 +08:00 [DBG] 设备 光电1 发送数据: 41-54-2B-53-54-41-43-48-32-3D-31-0D-0A
2025-07-31 15:01:07.470 +08:00 [DBG] 设备 光电1 数据发送完成
2025-07-31 15:01:07.470 +08:00 [DBG] 命令 AT+STACH2=1 已成功发送到 光电1
2025-07-31 15:01:07.470 +08:00 [DBG] 摆轮状态更新为: "SwingingLeft"
2025-07-31 15:01:07.470 +08:00 [INF] 已发送摆动命令: 左摆 (AT+STACH2=1) 并更新状态为: SwingingLeft
2025-07-31 15:01:07.470 +08:00 [DBG] 更新最后处理的格口为: 1
2025-07-31 15:01:07.470 +08:00 [DBG] 包裹 2839|78524833280058 匹配失败: 分拣状态为 "Processing"，非待处理.
2025-07-31 15:01:07.470 +08:00 [DBG] 找到下一个待处理包裹 2838|8498507911911，但格口 3 与当前格口 1 不符.
2025-07-31 15:01:07.470 +08:00 [DBG] 未找到合适的连续分拣包裹，执行正常回正流程
2025-07-31 15:01:07.470 +08:00 [DBG] 开始回正延迟等待 700ms，期间将忽略新的分拣信号...
2025-07-31 15:01:07.472 +08:00 [DBG] 设备 光电1 接收到 4 字节数据: 4F-4B-0D-0A
2025-07-31 15:01:07.472 +08:00 [DBG] 保存摆轮方向 "SwingingLeft" 用于回正
2025-07-31 15:01:07.472 +08:00 [DBG] 摆轮状态更新为: Resetting (回正延迟中)
2025-07-31 15:01:07.472 +08:00 [DBG] 分拣光电 光电1 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:07.473 +08:00 [DBG] 分拣光电 光电1 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:07.473 +08:00 [INF] 分拣光电 光电1 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:07.473 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:07.473 +08:00 [DBG] 分拣光电 光电1 触发，开始匹配包裹...
2025-07-31 15:01:07.473 +08:00 [DBG] 光电 光电1 的摆轮正在回正延迟中，忽略分拣信号
2025-07-31 15:01:07.473 +08:00 [DBG] 分拣光电 光电2 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:07.473 +08:00 [INF] 分拣光电 光电2 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:07.473 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:07.473 +08:00 [DBG] 分拣光电 光电2 触发，开始匹配包裹...
2025-07-31 15:01:07.473 +08:00 [DBG] 包裹 2839|78524833280058 匹配失败: 分拣状态为 "Processing"，非待处理.
2025-07-31 15:01:07.473 +08:00 [DBG] 找到连续分拣包裹，格口: 3，包裹: 2838
2025-07-31 15:01:07.473 +08:00 [INF] 找到等待的相同格口包裹，继续处理
2025-07-31 15:01:07.473 +08:00 [INF] 开始遍历 4 个待处理包裹进行匹配...
2025-07-31 15:01:07.473 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 8498507911911, 目标格口: 3, 触发时间: 15:01:02.882, 分拣状态: "Pending"
2025-07-31 15:01:07.473 +08:00 [INF] 包裹 2838|8498507911911 匹配失败: 时间范围不匹配. 时间差: 4591.7ms, 允许范围: [3800.0 - 4500.0]ms.
2025-07-31 15:01:07.473 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:07.473 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524833280058, 目标格口: 1, 触发时间: 15:01:03.801, 分拣状态: "Processing"
2025-07-31 15:01:07.473 +08:00 [DBG] 包裹 2839|78524833280058 匹配失败: 分拣状态为 "Processing"，非待处理.
2025-07-31 15:01:07.474 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:07.474 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524890654948, 目标格口: 1, 触发时间: 15:01:04.866, 分拣状态: "Pending"
2025-07-31 15:01:07.474 +08:00 [DBG] 包裹 2840|78524890654948 匹配失败: 格口 1 不属于光电 光电2.
2025-07-31 15:01:07.474 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:07.474 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78927962042351, 目标格口: 1, 触发时间: 15:01:05.926, 分拣状态: "Pending"
2025-07-31 15:01:07.474 +08:00 [DBG] 包裹 2841|78927962042351 匹配失败: 格口 1 不属于光电 光电2.
2025-07-31 15:01:07.474 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:07.474 +08:00 [DBG] 分拣光电 光电2: 未找到符合条件的待处理包裹.
2025-07-31 15:01:07.474 +08:00 [DBG] 分拣光电 光电2 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:07.474 +08:00 [WRN] 触发光电连接断开，已禁用重连逻辑，跳过重连
2025-07-31 15:01:07.474 +08:00 [DBG] 分拣光电 光电1 收到未知信号 'OK
'，已忽略
2025-07-31 15:01:07.737 +08:00 [DBG] 开始处理识别结果
2025-07-31 15:01:07.737 +08:00 [DBG] 设置触发时间戳: "2025-07-31T15:01:07.0880000+08:00"
2025-07-31 15:01:07.737 +08:00 [DBG] 设置包裹重量: 2.2 kg
2025-07-31 15:01:07.737 +08:00 [DBG] 设置包裹尺寸: L=24.73322296142578cm W=16.301715087890624cm H=13.1cm, Vol=5281.84cm³
2025-07-31 15:01:07.738 +08:00 [DBG] 已设置包裹图像
2025-07-31 15:01:07.738 +08:00 [INF] 已通过过滤器, 开始处理图像和保存.
2025-07-31 15:01:07.738 +08:00 [DBG] 生成潜在图像路径: D:\科\2025\07\31\78524890670435_20250731150107737.jpg
2025-07-31 15:01:07.739 +08:00 [DBG] 已更新 PackageInfo 的 ImagePath (可能为 null).
2025-07-31 15:01:07.740 +08:00 [DBG] 准备启动后台任务保存带水印图像.
2025-07-31 15:01:07.740 +08:00 [DBG] 图像处理和保存流程完成 (保存任务可能仍在后台运行).
2025-07-31 15:01:07.749 +08:00 [DBG] 后台保存任务开始.
2025-07-31 15:01:07.752 +08:00 [INF] 开始上传称重数据到安通API: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:07.752 +08:00 [DBG] 请求报文: {"WaybillCode":"78524890670435","Weight":2.2}
2025-07-31 15:01:07.752 +08:00 [DBG] GET请求URL: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:07.752 +08:00 [DBG] 请求体: {"waybillCode":"78524890670435","weight":"2.2"}
2025-07-31 15:01:07.752 +08:00 [INF] 包裹处理完成 - 各阶段耗时统计: 总耗时=16.1ms, 信号量等待=0.0ms, 图像处理=1.3ms, 对象创建=0.0ms, 条码设置=0.0ms, 时间戳设置=0.0ms, 重量设置=0.0ms, 尺寸设置=0.0ms, 图像设置=0.0ms, 数据处理=0.3ms, 推送耗时=14.6ms
2025-07-31 15:01:07.792 +08:00 [INF] 安通API称重数据上传成功: {"code":"0","msg":"Success","errMsg":null,"timestamp":"2025-07-31 15:01:09:612","data":{"provinceName":"山西省","carrierCode":"ZTO"}}
2025-07-31 15:01:07.793 +08:00 [INF] 包裹 78524890670435 安通API称重数据上传成功
2025-07-31 15:01:07.793 +08:00 [INF] 包裹 78524890670435 本地规则匹配到格口 1
2025-07-31 15:01:07.793 +08:00 [DBG] 已通过 EventAggregator 发布 PackageProcessingEvent.
2025-07-31 15:01:07.793 +08:00 [INF] 收到包裹 2842|78524890670435, 准备处理.
2025-07-31 15:01:07.793 +08:00 [DBG] 开始处理流程.
2025-07-31 15:01:07.793 +08:00 [DBG] 已有触发时间戳 15:01:07.088，跳过匹配逻辑.
2025-07-31 15:01:07.793 +08:00 [INF] 已添加到待处理队列. 目标格口: 1
2025-07-31 15:01:07.793 +08:00 [DBG] 设置分拣超时时间: 3500ms (光电 '光电1' 上限 3000ms + 500ms)
2025-07-31 15:01:07.803 +08:00 [DBG] 添加包裹记录：Barcode=78524890670435, CreateTime=2025-07-31 15:01:07, Status="Success"
2025-07-31 15:01:07.815 +08:00 [INF] 图像成功保存至 D:\科\2025\07\31\78524890670435_20250731150107737.jpg
2025-07-31 15:01:07.823 +08:00 [DBG] 添加包裹记录成功：78524890670435，已存入表 Packages_202507
2025-07-31 15:01:07.823 +08:00 [INF] 包裹记录已保存到数据库：78524890670435
2025-07-31 15:01:07.887 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:07.888 +08:00 [DBG] 分拣光电 光电1 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:08.000 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:08.001 +08:00 [DBG] 分拣光电 光电2 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:08.001 +08:00 [INF] 分拣光电 光电2 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:08.002 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:08.002 +08:00 [DBG] 分拣光电 光电2 触发，开始匹配包裹...
2025-07-31 15:01:08.002 +08:00 [DBG] 包裹 2839|78524833280058 匹配失败: 分拣状态为 "Processing"，非待处理.
2025-07-31 15:01:08.002 +08:00 [DBG] 找到下一个待处理包裹 2838|8498507911911，但格口 3 与当前格口 0 不符.
2025-07-31 15:01:08.002 +08:00 [INF] 队列中没有符合条件的相同格口包裹，立即执行回正
2025-07-31 15:01:08.002 +08:00 [DBG] 执行延迟回正.
2025-07-31 15:01:08.002 +08:00 [DBG] 根据保存的摆轮方向 "WaitingForNext" 确定回正方向为: 右
2025-07-31 15:01:08.002 +08:00 [DBG] 准备发送延迟 右 回正命令 (AT+STACH3=0)...
2025-07-31 15:01:08.002 +08:00 [DBG] 准备向 光电2 发送命令: AT+STACH3=0
2025-07-31 15:01:08.002 +08:00 [DBG] 设备 光电2 发送数据: 41-54-2B-53-54-41-43-48-33-3D-30-0D-0A
2025-07-31 15:01:08.002 +08:00 [DBG] 设备 光电2 数据发送完成
2025-07-31 15:01:08.002 +08:00 [DBG] 命令 AT+STACH3=0 已成功发送到 光电2
2025-07-31 15:01:08.002 +08:00 [INF] 延迟 右 回正命令 (AT+STACH3=0) 发送成功.
2025-07-31 15:01:08.003 +08:00 [DBG] 摆轮状态更新为: Reset
2025-07-31 15:01:08.003 +08:00 [DBG] 设备 光电2 接收到 4 字节数据: 4F-4B-0D-0A
2025-07-31 15:01:08.004 +08:00 [DBG] 分拣光电 光电2 收到未知信号 'OK
'，已忽略
2025-07-31 15:01:08.046 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:08.054 +08:00 [DBG] 分拣光电 光电1 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:08.055 +08:00 [INF] 分拣光电 光电1 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:08.055 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:08.055 +08:00 [DBG] 分拣光电 光电1 触发，开始匹配包裹...
2025-07-31 15:01:08.055 +08:00 [DBG] 光电 光电1 的摆轮正在回正延迟中，忽略分拣信号
2025-07-31 15:01:08.172 +08:00 [DBG] 回正延迟正常结束，开始执行回正
2025-07-31 15:01:08.172 +08:00 [DBG] 执行延迟回正.
2025-07-31 15:01:08.172 +08:00 [DBG] 根据保存的摆轮方向 "SwingingLeft" 确定回正方向为: 左
2025-07-31 15:01:08.172 +08:00 [DBG] 准备发送延迟 左 回正命令 (AT+STACH2=0)...
2025-07-31 15:01:08.172 +08:00 [DBG] 准备向 光电1 发送命令: AT+STACH2=0
2025-07-31 15:01:08.172 +08:00 [DBG] 设备 光电1 发送数据: 41-54-2B-53-54-41-43-48-32-3D-30-0D-0A
2025-07-31 15:01:08.173 +08:00 [DBG] 设备 光电1 数据发送完成
2025-07-31 15:01:08.173 +08:00 [DBG] 命令 AT+STACH2=0 已成功发送到 光电1
2025-07-31 15:01:08.173 +08:00 [INF] 延迟 左 回正命令 (AT+STACH2=0) 发送成功.
2025-07-31 15:01:08.173 +08:00 [DBG] 摆轮状态更新为: Reset
2025-07-31 15:01:08.173 +08:00 [DBG] 分拣动作完成，已从待处理队列移除. 已处理回正
2025-07-31 15:01:08.173 +08:00 [DBG] 包裹分拣状态已更新为: Sorted
2025-07-31 15:01:08.173 +08:00 [DBG] 已从处理中状态移除.
2025-07-31 15:01:08.173 +08:00 [DBG] 设备 光电1 接收到 4 字节数据: 4F-4B-0D-0A
2025-07-31 15:01:08.176 +08:00 [DBG] 分拣光电 光电1 收到未知信号 'OK
'，已忽略
2025-07-31 15:01:08.189 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:08.189 +08:00 [DBG] 分拣光电 光电2 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:08.339 +08:00 [ERR] 【分拣失败-超时】包裹 2838|8498507911911 分拣超时，错过目标光电 '光电2'。该包裹将直行至末端。
2025-07-31 15:01:08.339 +08:00 [INF] 包裹超时处理完成，摆轮状态保持不变。
2025-07-31 15:01:08.474 +08:00 [WRN] 触发光电连接断开，已禁用重连逻辑，跳过重连
2025-07-31 15:01:08.671 +08:00 [DBG] 开始处理识别结果
2025-07-31 15:01:08.671 +08:00 [DBG] 设置触发时间戳: "2025-07-31T15:01:08.1560000+08:00"
2025-07-31 15:01:08.671 +08:00 [DBG] 设置包裹重量: 2.16 kg
2025-07-31 15:01:08.671 +08:00 [DBG] 设置包裹尺寸: L=25.429432678222657cm W=16.117861938476562cm H=13.1cm, Vol=5369.27cm³
2025-07-31 15:01:08.671 +08:00 [DBG] 已设置包裹图像
2025-07-31 15:01:08.671 +08:00 [INF] 已通过过滤器, 开始处理图像和保存.
2025-07-31 15:01:08.671 +08:00 [DBG] 生成潜在图像路径: D:\科\2025\07\31\78524890663675_20250731150108670.jpg
2025-07-31 15:01:08.671 +08:00 [DBG] 已更新 PackageInfo 的 ImagePath (可能为 null).
2025-07-31 15:01:08.672 +08:00 [DBG] 准备启动后台任务保存带水印图像.
2025-07-31 15:01:08.672 +08:00 [DBG] 图像处理和保存流程完成 (保存任务可能仍在后台运行).
2025-07-31 15:01:08.673 +08:00 [INF] 开始上传称重数据到安通API: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:08.673 +08:00 [DBG] 请求报文: {"WaybillCode":"78524890663675","Weight":2.16}
2025-07-31 15:01:08.673 +08:00 [DBG] GET请求URL: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:08.673 +08:00 [DBG] 请求体: {"waybillCode":"78524890663675","weight":"2.16"}
2025-07-31 15:01:08.673 +08:00 [INF] 包裹处理完成 - 各阶段耗时统计: 总耗时=4.1ms, 信号量等待=0.0ms, 图像处理=1.0ms, 对象创建=0.8ms, 条码设置=0.0ms, 时间戳设置=0.1ms, 重量设置=0.0ms, 尺寸设置=0.0ms, 图像设置=0.0ms, 数据处理=1.1ms, 推送耗时=2.0ms
2025-07-31 15:01:08.674 +08:00 [DBG] 后台保存任务开始.
2025-07-31 15:01:08.727 +08:00 [INF] 图像成功保存至 D:\科\2025\07\31\78524890663675_20250731150108670.jpg
2025-07-31 15:01:08.730 +08:00 [INF] 安通API称重数据上传成功: {"code":"0","msg":"Success","errMsg":null,"timestamp":"2025-07-31 15:01:10:535","data":{"provinceName":"浙江省","carrierCode":"ZTO"}}
2025-07-31 15:01:08.754 +08:00 [INF] 包裹 78524890663675 安通API称重数据上传成功
2025-07-31 15:01:08.754 +08:00 [INF] 包裹 78524890663675 本地规则匹配到格口 1
2025-07-31 15:01:08.754 +08:00 [DBG] 已通过 EventAggregator 发布 PackageProcessingEvent.
2025-07-31 15:01:08.754 +08:00 [INF] 收到包裹 2843|78524890663675, 准备处理.
2025-07-31 15:01:08.754 +08:00 [DBG] 开始处理流程.
2025-07-31 15:01:08.754 +08:00 [DBG] 已有触发时间戳 15:01:08.156，跳过匹配逻辑.
2025-07-31 15:01:08.754 +08:00 [INF] 已添加到待处理队列. 目标格口: 1
2025-07-31 15:01:08.755 +08:00 [DBG] 设置分拣超时时间: 3500ms (光电 '光电1' 上限 3000ms + 500ms)
2025-07-31 15:01:08.759 +08:00 [DBG] 添加包裹记录：Barcode=78524890663675, CreateTime=2025-07-31 15:01:08, Status="Success"
2025-07-31 15:01:08.780 +08:00 [DBG] 添加包裹记录成功：78524890663675，已存入表 Packages_202507
2025-07-31 15:01:08.780 +08:00 [INF] 包裹记录已保存到数据库：78524890663675
2025-07-31 15:01:08.809 +08:00 [INF] 后台带水印图像保存成功, 路径: D:\科\2025\07\31\78524833280058_20250731150104491.jpg
2025-07-31 15:01:08.809 +08:00 [DBG] 后台保存任务结束.
2025-07-31 15:01:09.062 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:09.070 +08:00 [DBG] 分拣光电 光电1 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:09.291 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:10.077 +08:00 [INF] 后台带水印图像保存成功, 路径: D:\科\2025\07\31\78524890654948_20250731150105530.jpg
2025-07-31 15:01:10.077 +08:00 [DBG] 后台保存任务结束.
2025-07-31 15:01:10.077 +08:00 [WRN] 触发光电连接断开，已禁用重连逻辑，跳过重连
2025-07-31 15:01:10.077 +08:00 [ERR] 【分拣失败-超时】包裹 2840|78524890654948 分拣超时，错过目标光电 '光电1'。该包裹将直行至末端。
2025-07-31 15:01:10.077 +08:00 [INF] 包裹超时处理完成，摆轮状态保持不变。
2025-07-31 15:01:10.077 +08:00 [DBG] 分拣光电 光电1 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:10.077 +08:00 [INF] 分拣光电 光电1 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:10.077 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:10.077 +08:00 [DBG] 分拣光电 光电1 触发，开始匹配包裹...
2025-07-31 15:01:10.077 +08:00 [INF] 开始遍历 3 个待处理包裹进行匹配...
2025-07-31 15:01:10.078 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78927962042351, 目标格口: 1, 触发时间: 15:01:05.926, 分拣状态: "Pending"
2025-07-31 15:01:10.078 +08:00 [INF] 包裹 2841|78927962042351 匹配失败: 时间范围不匹配. 时间差: 4152.0ms, 允许范围: [2000.0 - 3000.0]ms.
2025-07-31 15:01:10.078 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:10.078 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524890670435, 目标格口: 1, 触发时间: 15:01:07.088, 分拣状态: "Pending"
2025-07-31 15:01:10.078 +08:00 [INF] ⏱️ 时间差计算: 当前时间 15:01:10.077 - 触发时间 15:01:07.088 = 2990.0ms
2025-07-31 15:01:10.078 +08:00 [INF] 📏 时间范围检查: 延迟 2990.0ms, 允许范围 [2000.0 - 3000.0]ms, 结果: ✅ 符合
2025-07-31 15:01:10.078 +08:00 [INF] 🎯 匹配成功! 包裹条码: 78524890670435, 格口: 1, 延迟: 2990.0ms, 光电: 光电1
2025-07-31 15:01:10.078 +08:00 [DBG] 包裹 78524890670435 已标记为由光电 光电1 处理中.
2025-07-31 15:01:10.078 +08:00 [DBG] 包裹条码: 78524890670435, 匹配成功，已停止并移除超时定时器.
2025-07-31 15:01:10.078 +08:00 [INF] 分拣光电 光电1 匹配到包裹 2842|78524890670435 (耗时: 2990.57ms)
2025-07-31 15:01:10.078 +08:00 [INF] 开始执行分拣动作 (光电: 光电1, 格口: 1).
2025-07-31 15:01:10.117 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:10.117 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:10.118 +08:00 [DBG] 分拣光电 光电2 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:10.118 +08:00 [INF] 分拣光电 光电2 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:10.119 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:10.119 +08:00 [DBG] 分拣光电 光电2 触发，开始匹配包裹...
2025-07-31 15:01:10.119 +08:00 [INF] 开始遍历 3 个待处理包裹进行匹配...
2025-07-31 15:01:10.119 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78927962042351, 目标格口: 1, 触发时间: 15:01:05.926, 分拣状态: "Pending"
2025-07-31 15:01:10.119 +08:00 [DBG] 包裹 2841|78927962042351 匹配失败: 格口 1 不属于光电 光电2.
2025-07-31 15:01:10.119 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:10.119 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524890670435, 目标格口: 1, 触发时间: 15:01:07.088, 分拣状态: "Processing"
2025-07-31 15:01:10.119 +08:00 [DBG] 包裹 2842|78524890670435 匹配失败: 分拣状态为 "Processing"，非待处理.
2025-07-31 15:01:10.119 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:10.119 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524890663675, 目标格口: 1, 触发时间: 15:01:08.156, 分拣状态: "Pending"
2025-07-31 15:01:10.119 +08:00 [DBG] 包裹 2843|78524890663675 匹配失败: 格口 1 不属于光电 光电2.
2025-07-31 15:01:10.119 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:10.120 +08:00 [DBG] 分拣光电 光电2: 未找到符合条件的待处理包裹.
2025-07-31 15:01:10.120 +08:00 [DBG] 分拣光电 光电1 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:10.260 +08:00 [DBG] 开始处理识别结果
2025-07-31 15:01:10.260 +08:00 [DBG] 设置触发时间戳: "2025-07-31T15:01:09.6380000+08:00"
2025-07-31 15:01:10.260 +08:00 [DBG] 设置包裹重量: 2.2 kg
2025-07-31 15:01:10.260 +08:00 [DBG] 设置包裹尺寸: L=25.63752136230469cm W=15.917570495605469cm H=13.1cm, Vol=5345.94cm³
2025-07-31 15:01:10.260 +08:00 [DBG] 已设置包裹图像
2025-07-31 15:01:10.260 +08:00 [INF] 已通过过滤器, 开始处理图像和保存.
2025-07-31 15:01:10.260 +08:00 [DBG] 生成潜在图像路径: D:\科\2025\07\31\78524890665849_20250731150110260.jpg
2025-07-31 15:01:10.260 +08:00 [DBG] 已更新 PackageInfo 的 ImagePath (可能为 null).
2025-07-31 15:01:10.261 +08:00 [DBG] 准备启动后台任务保存带水印图像.
2025-07-31 15:01:10.262 +08:00 [DBG] 图像处理和保存流程完成 (保存任务可能仍在后台运行).
2025-07-31 15:01:10.262 +08:00 [INF] 开始上传称重数据到安通API: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:10.262 +08:00 [DBG] 请求报文: {"WaybillCode":"78524890665849","Weight":2.2}
2025-07-31 15:01:10.262 +08:00 [DBG] GET请求URL: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:10.262 +08:00 [DBG] 请求体: {"waybillCode":"78524890665849","weight":"2.2"}
2025-07-31 15:01:10.262 +08:00 [INF] 包裹处理完成 - 各阶段耗时统计: 总耗时=3.5ms, 信号量等待=0.0ms, 图像处理=1.2ms, 对象创建=0.0ms, 条码设置=0.0ms, 时间戳设置=0.1ms, 重量设置=0.0ms, 尺寸设置=0.0ms, 图像设置=0.0ms, 数据处理=0.3ms, 推送耗时=1.9ms
2025-07-31 15:01:10.262 +08:00 [DBG] 后台保存任务开始.
2025-07-31 15:01:10.286 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:10.297 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:10.317 +08:00 [INF] 图像成功保存至 D:\科\2025\07\31\78524890665849_20250731150110260.jpg
2025-07-31 15:01:10.885 +08:00 [INF] 后台带水印图像保存成功, 路径: D:\科\2025\07\31\78927962042351_20250731150106421.jpg
2025-07-31 15:01:10.885 +08:00 [DBG] 后台保存任务结束.
2025-07-31 15:01:10.885 +08:00 [DBG] 摆动前状态检查 - 目标方向: "SwingingLeft", 当前状态: "Reset"
2025-07-31 15:01:10.885 +08:00 [INF] 状态不匹配：目标方向 "SwingingLeft" 与当前状态 "Reset" 不一致，执行纠正流程
2025-07-31 15:01:10.885 +08:00 [DBG] 发送摆动命令: 左摆 (AT+STACH2=1)
2025-07-31 15:01:10.885 +08:00 [DBG] 准备向 光电1 发送命令: AT+STACH2=1
2025-07-31 15:01:10.885 +08:00 [DBG] 设备 光电1 发送数据: 41-54-2B-53-54-41-43-48-32-3D-31-0D-0A
2025-07-31 15:01:10.885 +08:00 [DBG] 设备 光电1 数据发送完成
2025-07-31 15:01:10.885 +08:00 [DBG] 命令 AT+STACH2=1 已成功发送到 光电1
2025-07-31 15:01:10.885 +08:00 [DBG] 摆轮状态更新为: "SwingingLeft"
2025-07-31 15:01:10.885 +08:00 [INF] 已发送摆动命令: 左摆 (AT+STACH2=1) 并更新状态为: SwingingLeft
2025-07-31 15:01:10.885 +08:00 [DBG] 更新最后处理的格口为: 1
2025-07-31 15:01:10.885 +08:00 [DBG] 包裹 2842|78524890670435 匹配失败: 分拣状态为 "Processing"，非待处理.
2025-07-31 15:01:10.885 +08:00 [DBG] 找到连续分拣包裹，格口: 1，包裹: 2841
2025-07-31 15:01:10.885 +08:00 [DBG] 摆轮状态更新为: WaitingForNext，等待格口: 1，开始时间: "2025-07-31T15:01:10.8859232+08:00"
2025-07-31 15:01:10.885 +08:00 [INF] 连续分拣优化: 发现下一个包裹格口相同(1)，跳过回正，等待下一个包裹 (包裹: 2841)
2025-07-31 15:01:10.885 +08:00 [DBG] 分拣动作完成，已从待处理队列移除 (智能回正-跳过回正)
2025-07-31 15:01:10.886 +08:00 [DBG] 已从处理中状态移除.
2025-07-31 15:01:10.886 +08:00 [INF] 安通API称重数据上传成功: {"code":"0","msg":"Success","errMsg":null,"timestamp":"2025-07-31 15:01:12:129","data":{"provinceName":"广东省","carrierCode":"ZTO"}}
2025-07-31 15:01:10.886 +08:00 [INF] 包裹 78524890665849 安通API称重数据上传成功
2025-07-31 15:01:10.886 +08:00 [INF] 包裹 78524890665849 本地规则匹配到格口 1
2025-07-31 15:01:10.886 +08:00 [DBG] 已通过 EventAggregator 发布 PackageProcessingEvent.
2025-07-31 15:01:10.886 +08:00 [INF] 收到包裹 2844|78524890665849, 准备处理.
2025-07-31 15:01:10.886 +08:00 [DBG] 开始处理流程.
2025-07-31 15:01:10.886 +08:00 [DBG] 已有触发时间戳 15:01:09.638，跳过匹配逻辑.
2025-07-31 15:01:10.886 +08:00 [INF] 已添加到待处理队列. 目标格口: 1
2025-07-31 15:01:10.886 +08:00 [DBG] 设置分拣超时时间: 3500ms (光电 '光电1' 上限 3000ms + 500ms)
2025-07-31 15:01:10.886 +08:00 [DBG] 设备 光电1 接收到 4 字节数据: 4F-4B-0D-0A
2025-07-31 15:01:10.886 +08:00 [DBG] 添加包裹记录：Barcode=78524890665849, CreateTime=2025-07-31 15:01:10, Status="Success"
2025-07-31 15:01:10.925 +08:00 [DBG] 添加包裹记录成功：78524890665849，已存入表 Packages_202507
2025-07-31 15:01:10.925 +08:00 [INF] 包裹记录已保存到数据库：78524890665849
2025-07-31 15:01:10.925 +08:00 [DBG] 分拣光电 光电2 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:10.925 +08:00 [DBG] 分拣光电 光电1 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:10.925 +08:00 [INF] 分拣光电 光电1 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:10.925 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:10.926 +08:00 [DBG] 分拣光电 光电1 触发，开始匹配包裹...
2025-07-31 15:01:10.926 +08:00 [DBG] 找到连续分拣包裹，格口: 1，包裹: 2841
2025-07-31 15:01:10.926 +08:00 [INF] 找到等待的相同格口包裹，继续处理
2025-07-31 15:01:10.926 +08:00 [INF] 开始遍历 3 个待处理包裹进行匹配...
2025-07-31 15:01:10.926 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78927962042351, 目标格口: 1, 触发时间: 15:01:05.926, 分拣状态: "Pending"
2025-07-31 15:01:10.926 +08:00 [INF] 包裹 2841|78927962042351 匹配失败: 时间范围不匹配. 时间差: 5000.1ms, 允许范围: [2000.0 - 3000.0]ms.
2025-07-31 15:01:10.926 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:10.926 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524890663675, 目标格口: 1, 触发时间: 15:01:08.156, 分拣状态: "Pending"
2025-07-31 15:01:10.926 +08:00 [INF] ⏱️ 时间差计算: 当前时间 15:01:10.926 - 触发时间 15:01:08.156 = 2770.1ms
2025-07-31 15:01:10.926 +08:00 [INF] 📏 时间范围检查: 延迟 2770.1ms, 允许范围 [2000.0 - 3000.0]ms, 结果: ✅ 符合
2025-07-31 15:01:10.926 +08:00 [INF] 🎯 匹配成功! 包裹条码: 78524890663675, 格口: 1, 延迟: 2770.1ms, 光电: 光电1
2025-07-31 15:01:10.926 +08:00 [DBG] 包裹 78524890663675 已标记为由光电 光电1 处理中.
2025-07-31 15:01:10.926 +08:00 [DBG] 包裹条码: 78524890663675, 匹配成功，已停止并移除超时定时器.
2025-07-31 15:01:10.926 +08:00 [INF] 分拣光电 光电1 匹配到包裹 2843|78524890663675 (耗时: 2770.55ms)
2025-07-31 15:01:10.926 +08:00 [INF] 开始执行分拣动作 (光电: 光电1, 格口: 1).
2025-07-31 15:01:10.926 +08:00 [DBG] 分拣光电 光电1 收到未知信号 'OK
'，已忽略
2025-07-31 15:01:10.959 +08:00 [ERR] 【分拣失败-超时】包裹 2841|78927962042351 分拣超时，错过目标光电 '光电1'。该包裹将直行至末端。
2025-07-31 15:01:10.959 +08:00 [INF] 包裹超时处理完成，摆轮状态保持不变。
2025-07-31 15:01:11.100 +08:00 [WRN] 触发光电连接断开，已禁用重连逻辑，跳过重连
2025-07-31 15:01:11.128 +08:00 [DBG] 摆动前状态检查 - 目标方向: "SwingingLeft", 当前状态: "WaitingForNext"
2025-07-31 15:01:11.128 +08:00 [INF] 状态不匹配：目标方向 "SwingingLeft" 与当前状态 "WaitingForNext" 不一致，执行纠正流程
2025-07-31 15:01:11.128 +08:00 [DBG] 当前摆轮不在复位状态，先执行回正
2025-07-31 15:01:11.128 +08:00 [INF] 执行立即回正 (原因: 摆动前状态检查-回正, 光电: 光电1)
2025-07-31 15:01:11.128 +08:00 [DBG] 根据保存的摆轮方向 "WaitingForNext" 确定立即回正方向为: 右
2025-07-31 15:01:11.128 +08:00 [DBG] 发送 右 回正命令 (AT+STACH3=0)...
2025-07-31 15:01:11.128 +08:00 [DBG] 准备向 光电1 发送命令: AT+STACH3=0
2025-07-31 15:01:11.128 +08:00 [DBG] 设备 光电1 发送数据: 41-54-2B-53-54-41-43-48-33-3D-30-0D-0A
2025-07-31 15:01:11.128 +08:00 [DBG] 设备 光电1 数据发送完成
2025-07-31 15:01:11.128 +08:00 [DBG] 命令 AT+STACH3=0 已成功发送到 光电1
2025-07-31 15:01:11.128 +08:00 [DBG] 摆轮状态更新为: Reset
2025-07-31 15:01:11.128 +08:00 [INF] 立即 右 回正命令发送成功 (光电: 光电1)
2025-07-31 15:01:11.129 +08:00 [DBG] 设备 光电1 接收到 4 字节数据: 4F-4B-0D-0A
2025-07-31 15:01:11.136 +08:00 [DBG] 分拣光电 光电1 收到未知信号 'OK
'，已忽略
2025-07-31 15:01:11.149 +08:00 [DBG] 发送摆动命令: 左摆 (AT+STACH2=1)
2025-07-31 15:01:11.149 +08:00 [DBG] 准备向 光电1 发送命令: AT+STACH2=1
2025-07-31 15:01:11.149 +08:00 [DBG] 设备 光电1 发送数据: 41-54-2B-53-54-41-43-48-32-3D-31-0D-0A
2025-07-31 15:01:11.149 +08:00 [DBG] 设备 光电1 数据发送完成
2025-07-31 15:01:11.149 +08:00 [DBG] 命令 AT+STACH2=1 已成功发送到 光电1
2025-07-31 15:01:11.149 +08:00 [DBG] 摆轮状态更新为: "SwingingLeft"
2025-07-31 15:01:11.149 +08:00 [INF] 已发送摆动命令: 左摆 (AT+STACH2=1) 并更新状态为: SwingingLeft
2025-07-31 15:01:11.149 +08:00 [DBG] 更新最后处理的格口为: 1
2025-07-31 15:01:11.149 +08:00 [DBG] 包裹 2843|78524890663675 匹配失败: 分拣状态为 "Processing"，非待处理.
2025-07-31 15:01:11.149 +08:00 [DBG] 找到连续分拣包裹，格口: 1，包裹: 2844
2025-07-31 15:01:11.149 +08:00 [DBG] 摆轮状态更新为: WaitingForNext，等待格口: 1，开始时间: "2025-07-31T15:01:11.1495864+08:00"
2025-07-31 15:01:11.149 +08:00 [INF] 连续分拣优化: 发现下一个包裹格口相同(1)，跳过回正，等待下一个包裹 (包裹: 2844)
2025-07-31 15:01:11.149 +08:00 [DBG] 分拣动作完成，已从待处理队列移除 (智能回正-跳过回正)
2025-07-31 15:01:11.149 +08:00 [DBG] 已从处理中状态移除.
2025-07-31 15:01:11.149 +08:00 [DBG] 设备 光电1 接收到 4 字节数据: 4F-4B-0D-0A
2025-07-31 15:01:11.150 +08:00 [DBG] 分拣光电 光电1 收到未知信号 'OK
'，已忽略
2025-07-31 15:01:11.280 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:11.280 +08:00 [DBG] 分拣光电 光电2 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:11.281 +08:00 [INF] 分拣光电 光电2 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:11.281 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:11.281 +08:00 [DBG] 分拣光电 光电2 触发，开始匹配包裹...
2025-07-31 15:01:11.281 +08:00 [INF] 开始遍历 1 个待处理包裹进行匹配...
2025-07-31 15:01:11.281 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524890665849, 目标格口: 1, 触发时间: 15:01:09.638, 分拣状态: "Pending"
2025-07-31 15:01:11.281 +08:00 [DBG] 包裹 2844|78524890665849 匹配失败: 格口 1 不属于光电 光电2.
2025-07-31 15:01:11.281 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:11.281 +08:00 [DBG] 分拣光电 光电2: 未找到符合条件的待处理包裹.
2025-07-31 15:01:11.509 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:11.509 +08:00 [DBG] 分拣光电 光电2 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:11.601 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:11.601 +08:00 [DBG] 分拣光电 光电1 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:11.810 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:11.811 +08:00 [DBG] 分拣光电 光电1 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:11.811 +08:00 [INF] 分拣光电 光电1 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:11.811 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:11.811 +08:00 [DBG] 分拣光电 光电1 触发，开始匹配包裹...
2025-07-31 15:01:11.811 +08:00 [DBG] 找到连续分拣包裹，格口: 1，包裹: 2844
2025-07-31 15:01:11.811 +08:00 [INF] 找到等待的相同格口包裹，继续处理
2025-07-31 15:01:11.811 +08:00 [INF] 开始遍历 1 个待处理包裹进行匹配...
2025-07-31 15:01:11.811 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524890665849, 目标格口: 1, 触发时间: 15:01:09.638, 分拣状态: "Pending"
2025-07-31 15:01:11.811 +08:00 [INF] ⏱️ 时间差计算: 当前时间 15:01:11.811 - 触发时间 15:01:09.638 = 2173.6ms
2025-07-31 15:01:11.811 +08:00 [INF] 📏 时间范围检查: 延迟 2173.6ms, 允许范围 [2000.0 - 3000.0]ms, 结果: ✅ 符合
2025-07-31 15:01:11.811 +08:00 [INF] 🎯 匹配成功! 包裹条码: 78524890665849, 格口: 1, 延迟: 2173.6ms, 光电: 光电1
2025-07-31 15:01:11.811 +08:00 [DBG] 包裹 78524890665849 已标记为由光电 光电1 处理中.
2025-07-31 15:01:11.811 +08:00 [DBG] 包裹条码: 78524890665849, 匹配成功，已停止并移除超时定时器.
2025-07-31 15:01:11.811 +08:00 [INF] 分拣光电 光电1 匹配到包裹 2844|78524890665849 (耗时: 2173.91ms)
2025-07-31 15:01:11.811 +08:00 [INF] 开始执行分拣动作 (光电: 光电1, 格口: 1).
2025-07-31 15:01:11.987 +08:00 [INF] 后台带水印图像保存成功, 路径: D:\科\2025\07\31\78524890670435_20250731150107737.jpg
2025-07-31 15:01:11.987 +08:00 [DBG] 后台保存任务结束.
2025-07-31 15:01:12.012 +08:00 [DBG] 摆动前状态检查 - 目标方向: "SwingingLeft", 当前状态: "WaitingForNext"
2025-07-31 15:01:12.012 +08:00 [INF] 状态不匹配：目标方向 "SwingingLeft" 与当前状态 "WaitingForNext" 不一致，执行纠正流程
2025-07-31 15:01:12.012 +08:00 [DBG] 当前摆轮不在复位状态，先执行回正
2025-07-31 15:01:12.012 +08:00 [INF] 执行立即回正 (原因: 摆动前状态检查-回正, 光电: 光电1)
2025-07-31 15:01:12.012 +08:00 [DBG] 根据保存的摆轮方向 "WaitingForNext" 确定立即回正方向为: 右
2025-07-31 15:01:12.012 +08:00 [DBG] 发送 右 回正命令 (AT+STACH3=0)...
2025-07-31 15:01:12.012 +08:00 [DBG] 准备向 光电1 发送命令: AT+STACH3=0
2025-07-31 15:01:12.012 +08:00 [DBG] 设备 光电1 发送数据: 41-54-2B-53-54-41-43-48-33-3D-30-0D-0A
2025-07-31 15:01:12.012 +08:00 [DBG] 设备 光电1 数据发送完成
2025-07-31 15:01:12.012 +08:00 [DBG] 命令 AT+STACH3=0 已成功发送到 光电1
2025-07-31 15:01:12.012 +08:00 [DBG] 摆轮状态更新为: Reset
2025-07-31 15:01:12.012 +08:00 [INF] 立即 右 回正命令发送成功 (光电: 光电1)
2025-07-31 15:01:12.013 +08:00 [DBG] 设备 光电1 接收到 4 字节数据: 4F-4B-0D-0A
2025-07-31 15:01:12.013 +08:00 [DBG] 分拣光电 光电1 收到未知信号 'OK
'，已忽略
2025-07-31 15:01:12.033 +08:00 [DBG] 发送摆动命令: 左摆 (AT+STACH2=1)
2025-07-31 15:01:12.033 +08:00 [DBG] 准备向 光电1 发送命令: AT+STACH2=1
2025-07-31 15:01:12.033 +08:00 [DBG] 设备 光电1 发送数据: 41-54-2B-53-54-41-43-48-32-3D-31-0D-0A
2025-07-31 15:01:12.033 +08:00 [DBG] 设备 光电1 数据发送完成
2025-07-31 15:01:12.033 +08:00 [DBG] 命令 AT+STACH2=1 已成功发送到 光电1
2025-07-31 15:01:12.033 +08:00 [DBG] 摆轮状态更新为: "SwingingLeft"
2025-07-31 15:01:12.033 +08:00 [INF] 已发送摆动命令: 左摆 (AT+STACH2=1) 并更新状态为: SwingingLeft
2025-07-31 15:01:12.033 +08:00 [DBG] 更新最后处理的格口为: 1
2025-07-31 15:01:12.033 +08:00 [DBG] 包裹 2844|78524890665849 匹配失败: 分拣状态为 "Processing"，非待处理.
2025-07-31 15:01:12.033 +08:00 [DBG] 未找到下一个待处理包裹用于连续分拣.
2025-07-31 15:01:12.033 +08:00 [DBG] 未找到合适的连续分拣包裹，执行正常回正流程
2025-07-31 15:01:12.033 +08:00 [DBG] 开始回正延迟等待 700ms，期间将忽略新的分拣信号...
2025-07-31 15:01:12.033 +08:00 [DBG] 保存摆轮方向 "SwingingLeft" 用于回正
2025-07-31 15:01:12.034 +08:00 [DBG] 摆轮状态更新为: Resetting (回正延迟中)
2025-07-31 15:01:12.034 +08:00 [DBG] 设备 光电1 接收到 4 字节数据: 4F-4B-0D-0A
2025-07-31 15:01:12.034 +08:00 [DBG] 分拣光电 光电1 收到未知信号 'OK
'，已忽略
2025-07-31 15:01:12.101 +08:00 [WRN] 触发光电连接断开，已禁用重连逻辑，跳过重连
2025-07-31 15:01:12.393 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:12.394 +08:00 [DBG] 分拣光电 光电2 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:12.394 +08:00 [INF] 分拣光电 光电2 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:12.394 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:12.394 +08:00 [DBG] 分拣光电 光电2 触发，开始匹配包裹...
2025-07-31 15:01:12.394 +08:00 [INF] 开始遍历 1 个待处理包裹进行匹配...
2025-07-31 15:01:12.394 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524890665849, 目标格口: 1, 触发时间: 15:01:09.638, 分拣状态: "Processing"
2025-07-31 15:01:12.394 +08:00 [DBG] 包裹 2844|78524890665849 匹配失败: 分拣状态为 "Processing"，非待处理.
2025-07-31 15:01:12.394 +08:00 [INF] ❌ 匹配失败: 包裹未通过验证检查
2025-07-31 15:01:12.394 +08:00 [DBG] 分拣光电 光电2: 未找到符合条件的待处理包裹.
2025-07-31 15:01:12.582 +08:00 [DBG] 设备 光电2 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:12.582 +08:00 [DBG] 分拣光电 光电2 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:12.616 +08:00 [INF] 后台带水印图像保存成功, 路径: D:\科\2025\07\31\78524890663675_20250731150108670.jpg
2025-07-31 15:01:12.616 +08:00 [DBG] 后台保存任务结束.
2025-07-31 15:01:12.733 +08:00 [DBG] 回正延迟正常结束，开始执行回正
2025-07-31 15:01:12.733 +08:00 [DBG] 执行延迟回正.
2025-07-31 15:01:12.733 +08:00 [DBG] 根据保存的摆轮方向 "SwingingLeft" 确定回正方向为: 左
2025-07-31 15:01:12.733 +08:00 [DBG] 准备发送延迟 左 回正命令 (AT+STACH2=0)...
2025-07-31 15:01:12.733 +08:00 [DBG] 准备向 光电1 发送命令: AT+STACH2=0
2025-07-31 15:01:12.733 +08:00 [DBG] 设备 光电1 发送数据: 41-54-2B-53-54-41-43-48-32-3D-30-0D-0A
2025-07-31 15:01:12.733 +08:00 [DBG] 设备 光电1 数据发送完成
2025-07-31 15:01:12.733 +08:00 [DBG] 命令 AT+STACH2=0 已成功发送到 光电1
2025-07-31 15:01:12.733 +08:00 [INF] 延迟 左 回正命令 (AT+STACH2=0) 发送成功.
2025-07-31 15:01:12.733 +08:00 [DBG] 摆轮状态更新为: Reset
2025-07-31 15:01:12.733 +08:00 [DBG] 分拣动作完成，已从待处理队列移除. 已处理回正
2025-07-31 15:01:12.734 +08:00 [DBG] 包裹分拣状态已更新为: Sorted
2025-07-31 15:01:12.734 +08:00 [DBG] 已从处理中状态移除.
2025-07-31 15:01:12.734 +08:00 [DBG] 设备 光电1 接收到 4 字节数据: 4F-4B-0D-0A
2025-07-31 15:01:12.734 +08:00 [DBG] 分拣光电 光电1 收到未知信号 'OK
'，已忽略
2025-07-31 15:01:12.748 +08:00 [DBG] 开始处理识别结果
2025-07-31 15:01:12.748 +08:00 [DBG] 设置触发时间戳: "2025-07-31T15:01:11.9650000+08:00"
2025-07-31 15:01:12.748 +08:00 [DBG] 设置包裹重量: 2.17 kg
2025-07-31 15:01:12.748 +08:00 [DBG] 设置包裹尺寸: L=24.94379119873047cm W=15.66265869140625cm H=13.2cm, Vol=5157.06cm³
2025-07-31 15:01:12.748 +08:00 [DBG] 已设置包裹图像
2025-07-31 15:01:12.748 +08:00 [INF] 已通过过滤器, 开始处理图像和保存.
2025-07-31 15:01:12.748 +08:00 [DBG] 生成潜在图像路径: D:\科\2025\07\31\78524890678423_20250731150112748.jpg
2025-07-31 15:01:12.748 +08:00 [DBG] 已更新 PackageInfo 的 ImagePath (可能为 null).
2025-07-31 15:01:12.749 +08:00 [DBG] 准备启动后台任务保存带水印图像.
2025-07-31 15:01:12.749 +08:00 [DBG] 图像处理和保存流程完成 (保存任务可能仍在后台运行).
2025-07-31 15:01:12.749 +08:00 [DBG] 后台保存任务开始.
2025-07-31 15:01:12.749 +08:00 [INF] 开始上传称重数据到安通API: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:12.750 +08:00 [DBG] 请求报文: {"WaybillCode":"78524890678423","Weight":2.17}
2025-07-31 15:01:12.750 +08:00 [DBG] GET请求URL: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:12.750 +08:00 [DBG] 请求体: {"waybillCode":"78524890678423","weight":"2.17"}
2025-07-31 15:01:12.750 +08:00 [INF] 包裹处理完成 - 各阶段耗时统计: 总耗时=3.2ms, 信号量等待=0.0ms, 图像处理=1.1ms, 对象创建=0.0ms, 条码设置=0.0ms, 时间戳设置=0.1ms, 重量设置=0.1ms, 尺寸设置=0.0ms, 图像设置=0.0ms, 数据处理=0.3ms, 推送耗时=1.7ms
2025-07-31 15:01:12.787 +08:00 [INF] 安通API称重数据上传成功: {"code":"0","msg":"Success","errMsg":null,"timestamp":"2025-07-31 15:01:14:610","data":{"provinceName":"上海市","carrierCode":"ZTO"}}
2025-07-31 15:01:12.787 +08:00 [INF] 包裹 78524890678423 安通API称重数据上传成功
2025-07-31 15:01:12.787 +08:00 [INF] 包裹 78524890678423 本地规则匹配到格口 1
2025-07-31 15:01:12.787 +08:00 [DBG] 已通过 EventAggregator 发布 PackageProcessingEvent.
2025-07-31 15:01:12.787 +08:00 [INF] 收到包裹 2845|78524890678423, 准备处理.
2025-07-31 15:01:12.787 +08:00 [DBG] 开始处理流程.
2025-07-31 15:01:12.787 +08:00 [DBG] 已有触发时间戳 15:01:11.965，跳过匹配逻辑.
2025-07-31 15:01:12.787 +08:00 [INF] 已添加到待处理队列. 目标格口: 1
2025-07-31 15:01:12.787 +08:00 [DBG] 设置分拣超时时间: 3500ms (光电 '光电1' 上限 3000ms + 500ms)
2025-07-31 15:01:12.788 +08:00 [DBG] 添加包裹记录：Barcode=78524890678423, CreateTime=2025-07-31 15:01:12, Status="Success"
2025-07-31 15:01:12.808 +08:00 [DBG] 添加包裹记录成功：78524890678423，已存入表 Packages_202507
2025-07-31 15:01:12.808 +08:00 [INF] 包裹记录已保存到数据库：78524890678423
2025-07-31 15:01:12.812 +08:00 [INF] 图像成功保存至 D:\科\2025\07\31\78524890678423_20250731150112748.jpg
2025-07-31 15:01:13.100 +08:00 [WRN] 触发光电连接断开，已禁用重连逻辑，跳过重连
2025-07-31 15:01:13.697 +08:00 [DBG] 开始处理识别结果
2025-07-31 15:01:13.697 +08:00 [DBG] 设置触发时间戳: "2025-07-31T15:01:12.9980000+08:00"
2025-07-31 15:01:13.697 +08:00 [DBG] 设置包裹重量: 1.12 kg
2025-07-31 15:01:13.697 +08:00 [DBG] 设置包裹尺寸: L=30.224856567382812cm W=17.40936737060547cm H=9.5cm, Vol=4998.86cm³
2025-07-31 15:01:13.697 +08:00 [DBG] 已设置包裹图像
2025-07-31 15:01:13.698 +08:00 [INF] 已通过过滤器, 开始处理图像和保存.
2025-07-31 15:01:13.698 +08:00 [DBG] 生成潜在图像路径: D:\科\2025\07\31\73565959859752_20250731150113697.jpg
2025-07-31 15:01:13.698 +08:00 [DBG] 已更新 PackageInfo 的 ImagePath (可能为 null).
2025-07-31 15:01:13.698 +08:00 [DBG] 准备启动后台任务保存带水印图像.
2025-07-31 15:01:13.698 +08:00 [DBG] 图像处理和保存流程完成 (保存任务可能仍在后台运行).
2025-07-31 15:01:13.699 +08:00 [INF] 开始上传称重数据到安通API: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:13.699 +08:00 [DBG] 请求报文: {"WaybillCode":"73565959859752","Weight":1.12}
2025-07-31 15:01:13.699 +08:00 [DBG] GET请求URL: https://anapi.annto.com/bop/T201904230000000014/xjyc/weighing
2025-07-31 15:01:13.699 +08:00 [DBG] 请求体: {"waybillCode":"73565959859752","weight":"1.12"}
2025-07-31 15:01:13.699 +08:00 [INF] 包裹处理完成 - 各阶段耗时统计: 总耗时=3.7ms, 信号量等待=0.0ms, 图像处理=1.5ms, 对象创建=0.0ms, 条码设置=0.0ms, 时间戳设置=0.0ms, 重量设置=0.0ms, 尺寸设置=0.3ms, 图像设置=0.2ms, 数据处理=0.6ms, 推送耗时=1.5ms
2025-07-31 15:01:13.698 +08:00 [DBG] 后台保存任务开始.
2025-07-31 15:01:13.755 +08:00 [INF] 图像成功保存至 D:\科\2025\07\31\73565959859752_20250731150113697.jpg
2025-07-31 15:01:13.803 +08:00 [INF] 安通API称重数据上传成功: {"code":"0","msg":"Success","errMsg":null,"timestamp":"2025-07-31 15:01:15:629","data":{"provinceName":"广西壮族自治区","carrierCode":"ZTO"}}
2025-07-31 15:01:13.803 +08:00 [INF] 包裹 73565959859752 安通API称重数据上传成功
2025-07-31 15:01:13.804 +08:00 [INF] 包裹 73565959859752 本地规则匹配到格口 1
2025-07-31 15:01:13.804 +08:00 [DBG] 已通过 EventAggregator 发布 PackageProcessingEvent.
2025-07-31 15:01:13.804 +08:00 [INF] 收到包裹 2846|73565959859752, 准备处理.
2025-07-31 15:01:13.804 +08:00 [DBG] 开始处理流程.
2025-07-31 15:01:13.804 +08:00 [DBG] 已有触发时间戳 15:01:12.998，跳过匹配逻辑.
2025-07-31 15:01:13.804 +08:00 [INF] 已添加到待处理队列. 目标格口: 1
2025-07-31 15:01:13.804 +08:00 [DBG] 设置分拣超时时间: 3500ms (光电 '光电1' 上限 3000ms + 500ms)
2025-07-31 15:01:13.805 +08:00 [DBG] 添加包裹记录：Barcode=73565959859752, CreateTime=2025-07-31 15:01:13, Status="Success"
2025-07-31 15:01:13.825 +08:00 [DBG] 添加包裹记录成功：73565959859752，已存入表 Packages_202507
2025-07-31 15:01:13.826 +08:00 [INF] 包裹记录已保存到数据库：73565959859752
2025-07-31 15:01:13.898 +08:00 [INF] 后台带水印图像保存成功, 路径: D:\科\2025\07\31\78524890665849_20250731150110260.jpg
2025-07-31 15:01:13.899 +08:00 [DBG] 后台保存任务结束.
2025-07-31 15:01:13.931 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-30-0D-0A
2025-07-31 15:01:13.931 +08:00 [DBG] 分拣光电 光电1 收到低电平信号 '+OCCH1:0
'，已忽略
2025-07-31 15:01:14.102 +08:00 [WRN] 触发光电连接断开，已禁用重连逻辑，跳过重连
2025-07-31 15:01:14.160 +08:00 [DBG] 设备 光电1 接收到 10 字节数据: 2B-4F-43-43-48-31-3A-31-0D-0A
2025-07-31 15:01:14.160 +08:00 [DBG] 分拣光电 光电1 收到有效高电平信号: OCCH1高电平 - +OCCH1:1

2025-07-31 15:01:14.160 +08:00 [INF] 分拣光电 光电1 收到上升沿信号，开始匹配包裹
2025-07-31 15:01:14.160 +08:00 [DBG] 已通过 EventAggregator 发布 SortingSignalEvent.
2025-07-31 15:01:14.160 +08:00 [DBG] 分拣光电 光电1 触发，开始匹配包裹...
2025-07-31 15:01:14.160 +08:00 [INF] 开始遍历 2 个待处理包裹进行匹配...
2025-07-31 15:01:14.160 +08:00 [INF] 🔍 检查包裹匹配条件 - 包裹条码: 78524890678423, 目标格口: 1, 触发时间: 15:01:11.965, 分拣状态: "Pending"
2025-07-31 15:01:14.160 +08:00 [INF] ⏱️ 时间差计算: 当前时间 15:01:14.160 - 触发时间 15:01:11.965 = 2195.8ms
2025-07-31 15:01:14.160 +08:00 [INF] 📏 时间范围检查: 延迟 2195.8ms, 允许范围 [2000.0 - 3000.0]ms, 结果: ✅ 符合
2025-07-31 15:01:14.160 +08:00 [INF] 🎯 匹配成功! 包裹条码: 78524890678423, 格口: 1, 延迟: 2195.8ms, 光电: 光电1
2025-07-31 15:01:14.160 +08:00 [DBG] 包裹 78524890678423 已标记为由光电 光电1 处理中.
2025-07-31 15:01:14.161 +08:00 [DBG] 包裹条码: 78524890678423, 匹配成功，已停止并移除超时定时器.
2025-07-31 15:01:14.161 +08:00 [INF] 分拣光电 光电1 匹配到包裹 2845|78524890678423 (耗时: 2196.04ms)